---
title: "YubiKeyのセットアップ on ArchLinux"
date: 2022-11-04T20:26:34+09:00
tags:
  - YubiKey
---

完全にメモなので全く纏まっていないです。

## インストール

GUI でポチポチやりたかったので yubikey-manager-qt をインストール。
コマンドでやりたい場合は yubikey-manager を入れればいいが、なんとなくこっちの情報は少ないような気がしている。

SSH で使いたい場合は opensc パッケージもインストールする。

## pcscd.socket の有効化

これを有効化しないと "Failed connecting to YubiKey" と言われてしまう。

```shell
$ sudo systemctl enable --now pcscd.socket
```

適当にこのエラーメッセージで調べても書いていないことが多くて、ちょっと手間取ったけど、
CLI の方で出てきたエラーで検索したらこれが出てきて、解消した。

## PIN を設定したり…

yubikey-manager の Applications から PIV を選ぶと PIN の設定をしたり Certificate を追加したりするオプションが出てくる。

## SSH するための鍵を生成

Certificates のところで Authentication のスロットに鍵を保存する。今回は ECCP384 というやつを選んだ。
楕円曲線暗号らしいので雰囲気で RSA よりいいかなということで選んだだけなので、これがいい選択だったのかは分からん。
まあ必要ならすぐに生成し直せるので。

### SSH で使う

SSH の公開鍵は


```shell
$ ssh-keygen -D opensc-pkcs11.so
```

で得られるので、これを認証したいサーバに登録する。

接続するときは、

```shell
$ ssh -I opensc-pkcs11.so ホスト名
```

.ssh/config に書いておくと毎回指定しなくていい

```config
Host *
PKCS11Provider opensc-pkcs11.so
```

## とりあえずおわりに

この記事を GitHub に push するときに YubiKey に入っている鍵を使うつもりなので、
これが公開されているということは使えたということですはい。
